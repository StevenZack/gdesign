# 系统设计
- [整体架构](#整体架构)
- [HTTP服务器层](#http服务器层)
- [UDP发现层](#udp发现层)
- [文件传输模块](#文件传输模块)
- [远程控制模块](#远程控制模块)
- [摄像头直播模块](#摄像头直播模块)

## 整体架构

整个系统是又两个部分组成：网络核心库、UI层。

为什么要这样设计呢？由于本系统的目标是要做到跨多个平台(Windows,Linux,Android,Mac等)，为了减轻开发和维护的负担，整个系统必须最大化地将通用的部分剥离出来，尽量做到一次编写，到处运行。

因为移动端(Android)和桌面端(Windows,Linux,Mac)的UI差异太大，所以无法实现UI层的共享。但是，网络核心库在各个操作系统中是通用的，可以共享。因为本系统对于UI界面没有太大的要求，所以网络核心库是整个系统编写过程中的重中之重！在完成网络核心库之后，再将网络核心库集成到各大操作系统的UI程序里面，通过一个事件回调接口(后面会在系统初始化里面详细讲解)来实现网络核心库与UI层的通信。这样就实现了系统的跨平台。

其中，网络核心库主要分为两大模块：HTTP服务器模块、UDP广播发现模块

## HTTP服务器层

整个系统在启动的时候，第一步就是启动一个HTTP服务器。

这个HTTP服务器承载着文件传输、剪切板复制、摄像头直播和控制指令发送等功能。也就是说，基本上所有的模块都是基于这个HTTP服务器来传输信息和数据的。

### __1.系统初始化__

系统启动之后第一件事情就是进行系统初始化操作。系统在初始化的时候，需要传入几个参数：事件回调接口、HTTP服务器所要监听的端口号、临时文件夹的路径还有文件接收路径。如果所传入的参数为空的话，则使用默认的值。

(1) 事件回调接口(EventHandler)

事件回调接口(EventHandler)，是核心网络库向UI层通信的媒介。

为什么要设计这样一个接口？
    
    在GUI编程中，不管是桌面端，还是移动端。整个UI的操作、显示和修改，都是在同一个线程里面的，我们把这个线程叫做UI线程。在UI线程之中，是不允许进行一些耗时的操作的，比如说：Socket监听，网络请求等。否则会出现程序的图形界面卡死的情况。
    所以，在本系统中，因为需要启动一个HTTP服务器，这个HTTP服务器是绝对不能在UI线程中启动的，必须要另起一个新的线程。那么问题就来了，如果这个HTTP服务器有什么状态变化的情况（比如：HTTP服务器收到一个上传过来的文件，收到控制指令等），如何去通知UI线程，并在图形界面之中显示出来呢？
    我们只能设计这样一个接口，在UI层实现接口中定义好的方法，然后当HTTP服务器出现状态变化的时候，只需要调用该接口对应的方法即可。

事件回调接口是一个接口(Interface)，定义在网络核心库之中。里面定义了一些事件的方法，但是没有实现他们。这些方法是需要由UI层来实现的。因为UI层各有不同，比如收到的消息如何显示？在Android上是显示一个AlertDialog，在Windows上则是弹出一个AlertWindow。所以这些事件回调的方法，必须是由不同的UI层自己去实现，无法共享。

事件回调接口中包含一下事件方法：
- 当收到剪切板的时候
- 当收到Web上传的文件的时候
- 当收到其他客户端上传来的文件夹的时候
- 当新的设备上线或者下线的时候
- 当收到远程控制指令的时候
- 存储键值对
- 获取键值对

为什么事件回调接口中还需要包含存储键值对、获取键值对两个方法？

    